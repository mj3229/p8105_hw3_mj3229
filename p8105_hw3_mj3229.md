Homework 3
================

Mahitha Jangeti 10/13/25

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

## Problem 1

**Loading dataset and creating plot**

``` r
library(p8105.datasets)
data("instacart")

instacart_df = instacart
```

``` r
instacart_df %>% 
  group_by(aisle) %>% 
  summarize(n_obs = n()) %>% 
  mutate(aisle_rank = min_rank(desc(n_obs))) %>% 
  arrange(aisle_rank) %>% 
  filter(n_obs > 10000) %>% 
  ggplot(aes(x = aisle, y = n_obs)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Number of Items Ordered in each Aisle",
    x = "Aisle Name",
    y = "Number of Items Ordered"
  )
```

![](p8105_hw3_mj3229_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

**Creating Tables Based on Aisle**

``` r
instacart_df %>% 
  filter(aisle %in% c("baking ingredients")) %>% 
  group_by(aisle, product_name) %>% 
  summarize(n_baking = n()) %>% 
  mutate(baking_rank = min_rank(desc(n_baking))) %>% 
  arrange(baking_rank) %>% 
  filter(baking_rank <= 3)
```

    ## `summarise()` has grouped output by 'aisle'. You can override using the
    ## `.groups` argument.

    ## # A tibble: 3 × 4
    ## # Groups:   aisle [1]
    ##   aisle              product_name      n_baking baking_rank
    ##   <chr>              <chr>                <int>       <int>
    ## 1 baking ingredients Light Brown Sugar      499           1
    ## 2 baking ingredients Pure Baking Soda       387           2
    ## 3 baking ingredients Cane Sugar             336           3

``` r
instacart_df %>% 
  filter(aisle %in% c("dog food care")) %>% 
  group_by(aisle, product_name) %>% 
  summarize(n_dog = n()) %>% 
  mutate(dog_rank = min_rank(desc(n_dog))) %>% 
  arrange(dog_rank) %>% 
  filter(dog_rank <= 3)
```

    ## `summarise()` has grouped output by 'aisle'. You can override using the
    ## `.groups` argument.

    ## # A tibble: 3 × 4
    ## # Groups:   aisle [1]
    ##   aisle         product_name                                  n_dog dog_rank
    ##   <chr>         <chr>                                         <int>    <int>
    ## 1 dog food care Snack Sticks Chicken & Rice Recipe Dog Treats    30        1
    ## 2 dog food care Organix Chicken & Brown Rice Recipe              28        2
    ## 3 dog food care Small Dog Biscuits                               26        3

``` r
instacart_df %>% 
  filter(aisle %in% c("packaged vegetables fruits")) %>% 
  group_by(aisle, product_name) %>% 
  summarize(n_packaged = n()) %>% 
  mutate(packaged_rank = min_rank(desc(n_packaged))) %>% 
  arrange(packaged_rank) %>% 
  filter(packaged_rank <= 3)
```

    ## `summarise()` has grouped output by 'aisle'. You can override using the
    ## `.groups` argument.

    ## # A tibble: 3 × 4
    ## # Groups:   aisle [1]
    ##   aisle                      product_name         n_packaged packaged_rank
    ##   <chr>                      <chr>                     <int>         <int>
    ## 1 packaged vegetables fruits Organic Baby Spinach       9784             1
    ## 2 packaged vegetables fruits Organic Raspberries        5546             2
    ## 3 packaged vegetables fruits Organic Blueberries        4966             3

**Top three products in baking ingredients are light brown sugar, pure
baking soda, and cane sugar. Top three products in dog food care are
snack sticks chicken & rice recipe dog treats, organix chicken & brown
rice recipe, and small dog biscuits. Lastly, the top three products in
packaged vegetables fruits are organic baby spinach, organic
raspberries, and organic blueberries.**

**Creating Table for Pink Lady Apples and Coffee Ice Cream**

``` r
instacart_df %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
   mutate(
     order_dow = recode(order_dow,
                  `0` = "Monday",
                  `1` = "Tuesday",
                  `2` = "Wednesday",
                  `3` = "Thursday",
                  `4` = "Friday",
                  `5` = "Saturday",
                  `6` = "Sunday")) %>% 
  group_by(product_name, order_dow) %>% 
  rename("Product Name" = product_name) %>% 
  summarize(mean_hour = mean(order_hour_of_day, na.rm = TRUE)) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) %>% 
  knitr::kable(digits = 1)
```

    ## `summarise()` has grouped output by 'Product Name'. You can override using the
    ## `.groups` argument.

| Product Name     | Friday | Monday | Saturday | Sunday | Thursday | Tuesday | Wednesday |
|:-----------------|-------:|-------:|---------:|-------:|---------:|--------:|----------:|
| Coffee Ice Cream |   15.2 |   13.8 |     12.3 |   13.8 |     15.3 |    14.3 |      15.4 |
| Pink Lady Apples |   11.6 |   13.4 |     12.8 |   11.9 |     14.2 |    11.4 |      11.7 |

\*\*\*\*There are 134 aisles with most items order from the fresh
vegetables, fresh fruits, and packed vegetables fruits aisles. \*\*

## Problem 2

``` r
zori_df = 
  read_csv("./zillow_data/zori.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  relocate(county_name) %>% 
  select(-state, county = county_name) %>% 
  mutate(county = county %>% 
            str_replace("New York County", "New York") %>% 
            str_replace("Kings County", "Kings") %>%
            str_replace("Queens County", "Queens") %>%
            str_replace("Bronx County", "Bronx") %>%
            str_replace("Richmond County", "Richmond")) %>% 
  rename(zip_code = region_name) %>% 
  pivot_longer(
    x2015_01_31:x2024_08_31,
    names_to = "date",
    values_to = "zillow observed rent index")
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
  knitr::kable(head(zori_df, 8))
```

| county | region_id | size_rank | zip_code | region_type | state_name | city | metro | date | zillow observed rent index |
|:---|---:|---:|---:|:---|:---|:---|:---|:---|---:|
| Queens | 62080 | 4 | 11368 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_01_31 | NA |
| Queens | 62080 | 4 | 11368 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_02_28 | NA |
| Queens | 62080 | 4 | 11368 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_03_31 | NA |
| Queens | 62080 | 4 | 11368 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_04_30 | NA |
| Queens | 62080 | 4 | 11368 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_05_31 | NA |
| Queens | 62080 | 4 | 11368 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_06_30 | NA |
| Queens | 62080 | 4 | 11368 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_07_31 | NA |
| Queens | 62080 | 4 | 11368 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_08_31 | NA |

``` r
neighborhood_df = 
  read_csv("./zillow_data/zip_codes.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  relocate(county, neighborhood)
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
  knitr::kable(head(neighborhood_df, 8))
```

| county | neighborhood | state_fips | county_code | county_fips | zip_code | file_date |
|:---|:---|---:|:---|---:|---:|:---|
| Bronx | High Bridge and Morrisania | 36 | 005 | 36005 | 10451 | 7/25/07 |
| Bronx | High Bridge and Morrisania | 36 | 005 | 36005 | 10452 | 7/25/07 |
| Bronx | Central Bronx | 36 | 005 | 36005 | 10453 | 7/25/07 |
| Bronx | Hunts Point and Mott Haven | 36 | 005 | 36005 | 10454 | 7/25/07 |
| Bronx | Hunts Point and Mott Haven | 36 | 005 | 36005 | 10455 | 7/25/07 |
| Bronx | High Bridge and Morrisania | 36 | 005 | 36005 | 10456 | 7/25/07 |
| Bronx | Central Bronx | 36 | 005 | 36005 | 10457 | 7/25/07 |
| Bronx | Bronx Park and Fordham | 36 | 005 | 36005 | 10458 | 7/25/07 |

**Merging Datasets**

``` r
zillow_df = 
  left_join(zori_df, neighborhood_df, by = c("zip_code", "county")) %>%
  janitor::clean_names() %>% 
  relocate(county, neighborhood, zip_code, zillow_observed_rent_index)
  knitr::kable(head(zillow_df, 8))
```

| county | neighborhood | zip_code | zillow_observed_rent_index | region_id | size_rank | region_type | state_name | city | metro | date | state_fips | county_code | county_fips | file_date |
|:---|:---|---:|---:|---:|---:|:---|:---|:---|:---|:---|---:|:---|---:|:---|
| Queens | West Queens | 11368 | NA | 62080 | 4 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_01_31 | 36 | 081 | 36081 | 7/25/07 |
| Queens | West Queens | 11368 | NA | 62080 | 4 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_02_28 | 36 | 081 | 36081 | 7/25/07 |
| Queens | West Queens | 11368 | NA | 62080 | 4 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_03_31 | 36 | 081 | 36081 | 7/25/07 |
| Queens | West Queens | 11368 | NA | 62080 | 4 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_04_30 | 36 | 081 | 36081 | 7/25/07 |
| Queens | West Queens | 11368 | NA | 62080 | 4 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_05_31 | 36 | 081 | 36081 | 7/25/07 |
| Queens | West Queens | 11368 | NA | 62080 | 4 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_06_30 | 36 | 081 | 36081 | 7/25/07 |
| Queens | West Queens | 11368 | NA | 62080 | 4 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_07_31 | 36 | 081 | 36081 | 7/25/07 |
| Queens | West Queens | 11368 | NA | 62080 | 4 | zip | NY | New York | New York-Newark-Jersey City, NY-NJ-PA | x2015_08_31 | 36 | 081 | 36081 | 7/25/07 |

**Solving Problem 2**

``` r
zip_counts =
  zillow_df %>% 
  group_by(zip_code) %>% 
  summarize(n_obs = n()) %>% 
  filter(n_obs == 116)

zip_counts2 =
  zillow_df %>% 
  group_by(zip_code) %>% 
  summarize(n_obs = n()) %>% 
  filter(n_obs < 10)
```

``` r
zillow2_df = 
  zillow_df %>% 
  mutate(
    date = str_remove(date, "^x")) %>% 
  separate(date, into = c("year", "month", "day"), sep = "_") %>% 
  group_by(county, year) %>% 
  summarize(
    mean_zori = mean(zillow_observed_rent_index, na.rm = TRUE)
  ) %>% 
  rename(
    "Borough" = county,
    "Year" = year,
    "Average Rental Price" = mean_zori)
```

    ## `summarise()` has grouped output by 'county'. You can override using the
    ## `.groups` argument.

``` r
  knitr::kable(head(zillow2_df, 8))
```

| Borough | Year | Average Rental Price |
|:--------|:-----|---------------------:|
| Bronx   | 2015 |             1759.595 |
| Bronx   | 2016 |             1520.194 |
| Bronx   | 2017 |             1543.599 |
| Bronx   | 2018 |             1639.430 |
| Bronx   | 2019 |             1705.589 |
| Bronx   | 2020 |             1811.443 |
| Bronx   | 2021 |             1857.777 |
| Bronx   | 2022 |             2054.267 |

\*\* 149 zip codes are observed 116 times and 0 are observed less than
10 times
