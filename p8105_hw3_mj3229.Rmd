---
title: "Homework 3"
subtitle: "Mahitha Jangeti"
output: github_document
---
Mahitha Jangeti
10/13/25
```{r setup}
library(tidyverse)
```

## Problem 1
**Loading dataset and creating plot**

```{r}
library(p8105.datasets)
data("instacart")

instacart_df = instacart
```

```{r}
instacart_df %>% 
  group_by(aisle) %>% 
  summarize(n_obs = n()) %>% 
  mutate(aisle_rank = min_rank(desc(n_obs))) %>% 
  arrange(aisle_rank) %>% 
  filter(n_obs > 10000) %>% 
  ggplot(aes(x = aisle, y = n_obs)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Number of Items Ordered in each Aisle",
    x = "Aisle Name",
    y = "Number of Items Ordered"
  )
```

**Creating Tables Based on Aisle**

```{r}
instacart_df %>% 
  filter(aisle %in% c("baking ingredients")) %>% 
  group_by(aisle, product_name) %>% 
  summarize(n_baking = n()) %>% 
  mutate(baking_rank = min_rank(desc(n_baking))) %>% 
  arrange(baking_rank) %>% 
  filter(baking_rank <= 3)

instacart_df %>% 
  filter(aisle %in% c("dog food care")) %>% 
  group_by(aisle, product_name) %>% 
  summarize(n_dog = n()) %>% 
  mutate(dog_rank = min_rank(desc(n_dog))) %>% 
  arrange(dog_rank) %>% 
  filter(dog_rank <= 3)
  
instacart_df %>% 
  filter(aisle %in% c("packaged vegetables fruits")) %>% 
  group_by(aisle, product_name) %>% 
  summarize(n_packaged = n()) %>% 
  mutate(packaged_rank = min_rank(desc(n_packaged))) %>% 
  arrange(packaged_rank) %>% 
  filter(packaged_rank <= 3)
```

Top three products in baking ingredients are light brown sugar, pure baking soda, and cane sugar. Top three products in dog food care are snack sticks chicken & rice recipe dog treats, organix chicken & brown rice recipe, and small dog biscuits. Lastly, the top three products in packaged vegetables fruits are organic baby spinach, organic raspberries, and organic blueberries.


**Creating Table for Pink Lady Apples and Coffee Ice Cream** 

```{r}
instacart_df %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
   mutate(
     order_dow = recode(order_dow,
                  `0` = "Monday",
                  `1` = "Tuesday",
                  `2` = "Wednesday",
                  `3` = "Thursday",
                  `4` = "Friday",
                  `5` = "Saturday",
                  `6` = "Sunday")) %>% 
  group_by(product_name, order_dow) %>% 
  rename("Product Name" = product_name) %>% 
  summarize(mean_hour = mean(order_hour_of_day, na.rm = TRUE)) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  ) %>% 
  knitr::kable(digits = 1)
```

There are 134 aisles with most items order from the fresh vegetables, fresh fruits, and packed vegetables fruits aisles. 

## Problem 2

```{r}
zori_df = 
  read_csv("./zillow_data/zori.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  relocate(county_name) %>% 
  select(-state, county = county_name) %>% 
  mutate(county = county %>% 
            str_replace("New York County", "New York") %>% 
            str_replace("Kings County", "Kings") %>%
            str_replace("Queens County", "Queens") %>%
            str_replace("Bronx County", "Bronx") %>%
            str_replace("Richmond County", "Richmond")) %>% 
  rename(zip_code = region_name) %>% 
  pivot_longer(
    x2015_01_31:x2024_08_31,
    names_to = "date",
    values_to = "zillow observed rent index")
  knitr::kable(head(zori_df, 8))


neighborhood_df = 
  read_csv("./zillow_data/zip_codes.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  relocate(county, neighborhood)
  knitr::kable(head(neighborhood_df, 8))
```

**Merging Datasets**

```{r}
zillow_df = 
  left_join(zori_df, neighborhood_df, by = c("zip_code", "county")) %>%
  janitor::clean_names() %>% 
  relocate(county, neighborhood, zip_code, zillow_observed_rent_index)
  knitr::kable(head(zillow_df, 8))
```

**Zip Code Counts**

```{r}
zip_counts =
  zillow_df %>% 
  group_by(zip_code) %>% 
  summarize(n_obs = n()) %>% 
  filter(n_obs == 116)

zip_counts2 =
  zillow_df %>% 
  group_by(zip_code) %>% 
  summarize(n_obs = n()) %>% 
  filter(n_obs < 10)
```

149 zip codes are observed 116 times and 0 are observed less than 10 times

**Average rental price in each borough and year** 
```{r}
zillow2_df = 
  zillow_df %>% 
  mutate(
    date = str_remove(date, "^x")) %>% 
  separate(date, into = c("year", "month", "day"), sep = "_") %>% 
  group_by(county, year) %>% 
  summarize(
    mean_zori = mean(zillow_observed_rent_index, na.rm = TRUE)
  ) %>% 
  filter(!is.na(mean_zori)) %>% 
  rename(
    "Borough" = county,
    "Year" = year,
    "Average Rental Price" = mean_zori)
  knitr::kable(head(zillow2_df, 8))
```

The table indicates how average rent price has increased throughout all boroughs over the years. There are specifically big changes in the New York and Kings Boroughs. Additionally, New York borough in general has the most expensive average rental prices while Bronx lies on the lower range.

**Plot**

```{r}

```


## Problem 3

```{r}
accelero_df = 
  read_csv("./accelero_data/nhanes_accel.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  mutate(
    seqn = as.integer(seqn),  
  )


covar_df =
  read_csv("./accelero_data/nhanes_covar.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  slice(-1:-4) %>% 
  rename(
    seqn = x1,
    sex = x1_male,
    age = x3,
    bmi = x4,
    education = x1_less_than_high_school
  ) %>% 
   mutate(
    sex = recode(sex, `1` = "Male", `2` = "Female"),
    education = recode(education,
                       `1` = "Less than high school",
                       `2` = "High school equivalent",
                       `3` = "More than high school"),
    seqn = as.integer(seqn),  
    age = readr::parse_number(as.character(age)),
    bmi = readr::parse_number(as.character(bmi))
  ) %>%
  filter(age >= 21) %>%
  drop_na(sex, age, bmi, education) 


nhanes_df = 
  left_join(covar_df, accelero_df, by = "seqn" )
```

**Men and Women in each Education Category**

```{r}
education_df = 
nhanes_df %>% 
  group_by(education, sex) %>% 
  summarize(n_hanes = n(), .groups = "drop") %>% 
   pivot_wider(
    names_from = sex,
    values_from = n_hanes
  ) %>% 
  rename(
    "Education" = education)
  knitr::kable(head(education_df, 8))
```

**Plot for Age Distributions for Men and Women in each Education Category**
```{r}
nhanes_df %>% 
  ggplot(aes(x = age, fill = sex)) +
  geom_density(alpha = .3, adjust = .5) +
  facet_wrap(~ education)
  labs(
    title = "Age Density by Sex and Education Level",
    x = "Age (years)",
    y = "Density",
    fill = "Sex"
  ) +
  theme_minimal()
```

**Total Activity**

```{r}
nhanes_df %>% 
  mutate(total_activity = rowSums(across(min1:min45), na.rm = TRUE)) %>% 
  select(seqn, sex, age, bmi, education, total_activity ) %>% 
  ggplot(aes(x = age, y = total_activity)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_wrap(~ sex)
```

**24 Hour Activity Time Courses**

```{r}
activity_df =
  nhanes_df %>% 
 pivot_longer(
    cols = starts_with("min"),
    names_to = "minute",
    names_prefix = "min",
    values_to = "activity_time"
  ) %>%  
  mutate(
    minute = as.integer(minute),
    hour = minute/60
  )


activity_df %>% 
  group_by(education, sex, hour) %>% 
  summarize(mean_activity = mean(activity_time, na.rm = TRUE), .groups = "drop") %>% 
  ggplot(aes(x = hour, y = mean_activity, color = sex)) +
  geom_line(alpha = 0.2) +
  geom_smooth(se = FALSE) +
  facet_wrap(~ education, ncol = 1) +
  scale_x_continuous(breaks = seq(0, 24, by = 3)) +
  labs(
    title = "24-Hour Activity Time Course by Sex and Education",
    x = "Hour",
    y = "Mean Activity",
    color = "Sex"
  ) +
  theme_minimal()
```

